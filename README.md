# AI-Powered Agricultural Weather Intelligence System

This repository contains an end-to-end, explainable system for agricultural weather forecasting and farmer advisories. The system combines multiple weather APIs, learns how reliable each source is, fuses them intelligently, predicts future weather ranges, and converts those predictions into farmer-friendly guidance using an LLM.

The design avoids black-box ensembling and instead uses transparent, physics-aware features and error-based weighting so every decision can be explained.

---

## What the system does

1. Fetches long-term and recent weather data from multiple APIs (NASA POWER, Open-Meteo).
2. Measures how accurate each API has been recently.
3. Assigns higher weight to more reliable APIs.
4. Fuses all sources into a single clean dataset.
5. Engineers agro-meteorological features (rainfall sums, temperature ranges, ET₀, humidity trends).
6. Trains a sequence-to-sequence LSTM to predict future weather.
7. Produces prediction ranges (not single values) to capture uncertainty.
8. Generates irrigation and risk advisories.
9. Uses an LLM only to convert results into clear, farmer-friendly language.

---

## Project structure

```
.
├── data/
│   ├── raw/                 # Raw Open-Meteo JSON data
│   ├── nasa_power/          # Raw NASA POWER CSV data
│   └── processed/
│       ├── fused_proc.csv   # Final fused & scaled dataset
│       ├── fused_scaler.pkl # Scaler used for training/inference
│       ├── weights.json     # Current API weights
│       └── fused_errors.json
│
├── models/
│   └── lstm_weather.py      # Seq2Seq LSTM model
│
├── src/
│   ├── data_fetch.py        # Fetch raw data from APIs
│   ├── preprocess.py        # Fusion, weighting, feature engineering
│   ├── utils_fusion.py      # Alignment, RMSE, weighting logic
│   ├── train.py             # Model training
│   ├── predict_and_advisory.py
│   ├── llm_interface.py     # LLM interaction
│   └── scheduler.py         # Hourly automation
│
├── best_model.pth           # Saved trained model
└── README.md
```

---

## Requirements

Python 3.9 or higher is recommended.

Required packages:

* numpy
* pandas
* requests
* scikit-learn
* joblib
* torch
* apscheduler

Install them using:

```
pip install -r requirements.txt
```

You also need **Ollama** installed locally for LLM-based text generation:

```
ollama pull llama:7b
```

---

## How to run the system

### Step 1: Fetch weather data

```
python src/data_fetch.py
```

This downloads historical daily data (around 10 years) and stores it as raw files.

---

### Step 2: Preprocess and fuse APIs

```
python src/preprocess.py
```

This step:

* Aligns all APIs by date
* Computes recent RMSE for each API
* Converts errors into weights
* Smooths weights over time
* Fuses data using weighted averaging
* Engineers agro-meteorological features
* Scales and saves the final dataset

---

### Step 3: Train the model

```
python src/train.py
```

This trains a Seq2Seq LSTM on the fused dataset and saves the best model as `best_model.pth`.

---

### Step 4: Predict and generate advisory

```
python src/predict_and_advisory.py
```

This produces:

* Weather forecasts as ranges (10th, 50th, 90th percentile)
* Rainfall and irrigation guidance
* Risk indicators (for example fungal disease risk)
* A farmer-friendly explanation generated by the LLM

---

### Step 5: Run automatically (optional)

```
python src/scheduler.py
```

This runs the full pipeline (fetch → preprocess → predict) every hour.

---

## How API weighting works

Each API is evaluated on recent historical data. The root-mean-square error (RMSE) is computed against a reference source (NASA POWER by default).

Weights are computed as:

```
weight = 1 / (RMSE + ε)
```

They are normalized and smoothed over time. More accurate APIs automatically influence the forecast more.

---

## Why predictions are ranges

Weather is uncertain. Instead of predicting a single value, the model uses Monte-Carlo dropout to generate distributions and reports:

* P10: pessimistic scenario
* P50: most likely scenario
* P90: optimistic scenario

This is more useful for real agricultural decisions than point estimates.

---

## Design principles

* No black-box ensembling
* No LLM-only forecasting
* Physics-aware features
* Fully explainable weighting and fusion
* Clear separation between data, model, and language layers

---

## Author

Sai Sindhush Penugonda
B.Tech Computer Science, IIT Delhi

---

This README is intentionally simple and direct so that the full system can be understood, run, and explained without ambiguity.
